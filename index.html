<!DOCTYPE html>
<html>
<head>
  <title>MetaCoin - Truffle Webpack Demo w/ Frontend</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="app.js"></script>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAefXK91jWaL5BEqOGwradwMhcUCQizsEI&libraries=places"></script> -->
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAefXK91jWaL5BEqOGwradwMhcUCQizsEI"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.0.0/d3.js" charset="utf-8"></script>


</head>
<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="60">

  <!-- <h1>MetaCoin</h1>
  <h2>Example Truffle Dapp</h2>
  <h3>You have <span class="black"><span id="balance"></span> META</span></h3>

  <br>
  <h1>Send MetaCoin</h1>
  <br><label for="amount">Amount:</label><input type="text" id="amount" placeholder="e.g., 95"></input>
  <br><label for="receiver">To Address:</label><input type="text" id="receiver" placeholder="e.g., 0x93e66d9baea28c17d9fc393b53e3fbdd76899dae"></input>
  <br><br><button id="send" onclick="App.sendCoin()">Send MetaCoin</button>
  <br><br> -->
  <span id="status"></span>

  <!-- <button onclick="App.myFun()">Click</button> -->


<h1 style="color:#8d8cec;font-weight: bold">NASACHAINS</h1>
<br>
<!-- <button onclick="App2.getCoordinates()">Send Coordinates</button>

<button onclick="App2.getCoordinates2()">get Api data</button>

<button  onclick="App2.isOwner()">check me</button>

<button >Refresh Landslide Data</button> 
<button>Refresh Precepitation Data</button>

<button>Check  </button> -->

  


  

<!-- <div class="container">
  
  <p id="demo"></p>
 
</div> -->





  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#myPage">NASA CHAIN</a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="#about" id="">Create Alert</a>
          </li>
          <li>
            <a href="#services">Check Statistics</a>
          </li>
          <li>
            <a href="#portfolio">Claims</a>
          </li>
          <li>
            <a href="#pricing">Check Alert</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="jumbotron text-center">
    <h1>LOCATION CHECK</h1>
    <p>Instantly check any disaster/landslide issues near your location</p>
    <button type="button" class="btn btn-default" onclick="getCoordinates2()" 
     style="text-align: center; padding-left: 300px; font-weight: bold; font-size: larger; padding-right: 300px;">AM I SAFE!!</button>
    <!-- <form>
      <input type="text" name="location" class="form-control" size="50" id="Location" onfocus="window.onfocuslocation();">
    </form> -->
  </div>

  <!-- Container (About Section) -->
  <div id="about" class="container-fluid">
    <div class="row">
      <div class="col-sm-8">
        <h2>Create Alert</h2>
        <br>
        
        <br>
        <p>
           Alert is being created as soon as trigger from global LHASA (Landslide Hazard Assessment for Situational Awareness)
           model is obtained. It is a global landslide model built recently i.e. April 2018 & integrated
           with IMERG(Integrated Multi Satellite Retrievals for GPM) which shows recent precipitation & updated every 30 minutes. 
           In order to access location, we have used custom API (data.nasa.gov/resource/tfkf-kniw.json) to access location data for high alert in our smart contract.
        </p>
        <br>
        <button class="btn btn-default btn-lg">CREATE ALERT</button>
      </div>
      <div class="col-sm-4">
        <span class="glyphicon glyphicon-signal logo"></span>
      </div>
    </div>
  </div>

  <!-- Container (Portfolio Section) -->
  <div id="portfolio" class="container-fluid text-center bg-grey">
    <h2>Claims and Settlements</h2>
    <br>
    <h4>What we have created</h4>
    <input type="text" id="input1" placeholder="Request for Resoures" />
    <input type="text" id="input2" placeholder="receiver address" />
    <input type="text" id="input3" placeholder="receiver resources" />
    <form onSubmit="App.createTask(); return false;">
      <input id="newTask" type="text" class="form-control" placeholder="Add task..." required>
      <input type="submit">
      </form>
      <ul id="taskList" class="list-unstyled">
          <div class="taskTemplate" class="checkbox" style="display: none">
              <label>
                  <input type="checkbox" />
                  <span class="content">Task content goes here...</span>
              </label>
          </div>
      </ul>
      <ul id="completedTaskList" class="list-unstyled">
      </ul>

    <input type="button" id="button1"class="" style="margin-top: 150px;" value="getresources" onclick="App.load()"/>
    <input type="button" id="button2" value="complete transaction" onclick="App.CompleteTransaction()"/>
  
    <input type="button" id="button3" style="margin-top: 5px;" class="btn btn-success" value="Balance of account" onclick="App.GetBalance()" style="float: left" />
    <p id="balanceresult"></p> 
  
  
  
  </div>

    <br>

    
    
  </div>

  <!-- Container (Pricing Section) -->
  <div id="pricing" class="container-fluid">
    <div class="text-center">
      <h2>CHECK ALERT</h2>
      <h4>Check if you are in the effected area</h4>
      <button type="button" class="btn btn-primary" onclick="getCoordinates2()">CHECK</button>
    </div>
  </div>

  <footer class="container-fluid text-center">
    <a href="#myPage" title="To Top">
      <span class="glyphicon glyphicon-chevron-up"></span>
    </a>
    <p>Developed By
      <a href="#" title="Visit w3schools">Minor Chain</a>
    </p>
  </footer>

  <script>
    function getCoordinates2() {
    var lat = -45.9034;
    var long = 80.0982;
    var shortest = 0;
    var trigger_alert = false;
    var are_you_safe = "You are Safe";
    var are_you_safe_msg = "You are quiet far from affected area.";
    var are_you_safe_type = "success";


    var url = "https://data.nasa.gov/resource/tfkf-kniw.json";
    $.get(
      url,
      function (data) {
        if (data && data.length > 0) {
          for (var i = 0; i <= data.length; i++) {
            if (data[i]) {
              var data_shortest = getDistanceFromLatLonInKm(lat, long, parseInt(data[i].latitude), parseInt(data[i].longitude));
              if (i == 0) {
                shortest = data_shortest;
              }
              if (shortest >= data_shortest && data_shortest > 0) {
                shortest = data_shortest;
              }
              if(locationCheck(lat, long, parseInt(data[i].latitude), parseInt(data[i].longitude))) {
                console.log(data[i].latitude)
                shortest = -1;
              }
            }
          }
        }

        if (shortest == -1) {
          trigger_alert = true;
          are_you_safe = "Danger Around";
          are_you_safe_msg = "You are very near to affected area. You are in the radius of 20km." ;
          are_you_safe_type = "warning";
        }

        swal(are_you_safe, are_you_safe_msg, are_you_safe_type);
        $(".result").html(data);

      }
    );

  };
  </script>
  <script>
    function locationCheck(lat1, lon1, lat2, lon2) {
      var userLat = Math.round(lat1); 
      var userLon = Math.round(lon1); 
      var preLat = Math.round(lat2); 
      var preLon = Math.round(lon2); 
      return (userLat == preLat) && (userLon == preLon);
    }

    function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
      var R = 6371; // Radius of the earth in km
      var dLat = deg2rad(lat2 - lat1);  // deg2rad below
      var dLon = deg2rad(lon2 - lon1);
      var a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2)
        ;
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      var d = R * c; // Distance in km
      return d;
    }
    
    function deg2rad(deg) {
      return deg * (Math.PI / 180)
    }
  </script>
</body>
</html>
